<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no">
    <title>T-Rex Runner</title>
    <link rel="stylesheet" href="notyf.min.css">
    <script src="notyf.min.js"></script>
    <script src="qrcode.min.js"></script>

    <link rel="stylesheet" href="index.css?v=2404221746">
    <script src="config.js?v=2404221746"></script>
    <script src="index.js?v=2404221746"></script>
    <script src="wsConnection.js?v=2404221746"></script>
    <script src="touch.js?v=2404221746"></script>
</head>

<body id="t" class="offline">
    <div id="qrcode-overlay">
        <div id="qrcode-container">
            <div id="qrcode-text">
                <p>使用DG-LAB APP扫码建立WebSocket链接</p>
            </div>
            <div id="qrcode"></div>
            <div class="close-qrcode" onclick="hideqrcode()">关闭</div>
        </div>
    </div>
    <div class="header-container">
        <div class="status-container">
            <div class="status">
                <span>当前状态: </span>
                <span id="status" class="red">未连接</span>
                <span id="status-light" class="red"> ●</span>
            </div>
            <div class="connect-btn">
                <button onclick="showInfo()">使用说明</button>
                <button onclick="connectOrDisconn()" id="status-btn">连接</button>
            </div>
        </div>
        <div class="information-overlay" id="information-overlay">
            <div class="information">
                <h2>使用说明</h2>
                <p>
                    这是郊狼Socket控制官方demo，<span class="notify">本功能目前只支持郊狼3.0连接</span>。
                    <br><br>
                    Socket控制模式下，手机APP通过Socket服务连接到第三方控制端，并将收到的数据转发给郊狼。从而允许开发者通过网页、游戏或其他终端对郊狼进行控制。和远程控制类似，您也可以为本模式设置强度上限保护。
                    <br><br>
                    当前页面是我们提供的Web游戏demo，当小恐龙碰到障碍物时，就会控制郊狼输出脉冲。
                    <br><br>
                    要开始游戏，首先点击右上角<span class="notify">【连接】</span>按钮生成二维码。然后在APP中选择右下角<span class="notify">【Socket控制】</span>模式，连接设备后点击<span class="notify">【连接socket服务器】</span>按钮扫码完成连接。
                    <br><br>
                    我们已经在GitHub上开源相关协议和示例代码，以便开发者们自行搭建服务器进行控制，详情请访问链接：<span class="notify"><a href="https://github.com/DG-LAB-OPENSOURCE/DG-LAB-OPENSOURCE">点此跳转GitHub</a></span>
                    <br><br>
                    需要注意的是，Socket控制协议是开放的，我们无法对第三方控制端进行审核。<span class="notify"><strong>请不要扫描来源不明的Socket二维码</strong></span>。在您准备进行连接前，<span class="notify"><strong>请确保您已经设置好强度上限保护</strong></span>。
                </p>
                <div class="info-close">
                    <button class="info-close-btn" onclick="closeInfo()">我知道了</button>
                </div>
            </div>
        </div>
        <div class="dg-controller" id="touchArea">
            <div class="current" id="touch"></div>
            <span class="tptc">low&larr;频率&rarr;high</span>
            <span class="tplc">&larr;强度&rarr;</span>
            <hr class="hr-edge-weak" style="top: 33.33%;"/>
            <hr class="hr-edge-weak" style="top: 66.67%;"/>
            <div class="sx" style="left: 33.33%;"></div>
            <div class="sx" style="left: 66.67%;"></div>
        </div>
    </div>
</body>

<script>
    var qrcode = document.getElementById("qrcode-overlay");
    var qrcodeImg = new QRCode(document.getElementById("qrcode"), "https://www.dungeon-lab.com/app-download.php#DGLAB-SOCKET#ws://39.108.168.199:9999/"); // 全局二维码
    let gamePanelInit = true;

    document.onkeydown = function (evt) {
        evt = evt || window.event;
        if (evt.keyCode == 32 && wsConn != null && targetWSId !== "" && gamePanelInit) {
            evt.preventDefault();
            document.getElementById("messageBox").querySelector('h1').textContent = '';
            document.querySelector('.offline .runner-container').style.top = '10px';
            gamePanelInit = false;
        }
        else if (evt.keyCode == 32) {
            // 阻止默认的空格键行为
            evt.preventDefault();
        }
    };
    function hideqrcode() {
        qrcode.style.visibility = "hidden";
    }
    function showqrcode() {
        qrcode.style.visibility = "visible";
    }

    const questionIcons = document.querySelectorAll('.question-img'); // 获取所有提示图标
    const tooltip = document.getElementById('tooltip');

    const tipsMsg = {
        'question1': '当此通道软上限强度变化时，自动把此通道强度设置为软上限强度。(注意：开启后失败增加强度功能失效)',
        'question2': '当小恐龙碰到障碍物时，此通道强度自动增加设置的值。(默认为+0) 注意：开启强度跟随软上限功能后此功能失效。',
        'question3': '清除当前APP内此通道正在执行的波形数据，避免新的波形数据被之前的覆盖。'
    }

    // 鼠标悬停事件
    questionIcons.forEach(icon => {
        icon.addEventListener('mouseover', function (event) {
            const x = event.clientX;
            const y = event.clientY;

            // 根据当前图标ID设置相应的提示文本
            tooltip.innerText = `${tipsMsg[icon.id]}`;

            tooltip.style.display = 'block';
            tooltip.style.left = x + 'px';
            tooltip.style.top = y + 'px';
        });

        // 鼠标离开事件
        icon.addEventListener('mouseout', function (event) {
            tooltip.style.display = 'none'; // 隐藏提示文字
        });
    });

    function showInfo() {
        document.getElementById("information-overlay").style.visibility = "visible";
    }

    function closeInfo() {
        document.getElementById("information-overlay").style.visibility = "hidden";
    }

    function hideOrShowTips() {
        const tips = document.querySelector('.game-content');
        if (tips.style.display === 'none') {
            tips.style.display = 'block';
            document.getElementById('tip-btn').textContent = '隐藏';
            document.getElementById('messageBox').style.display = 'block';
        } else {
            tips.style.display = 'none';
            document.getElementById('tip-btn').textContent = '显示';
            document.getElementById('messageBox').style.display = 'none';
        }
    }

</script>

</html>